
CREATE
	

 PROCEDURE [dbo].[System_Navigation_Associated_Search] @LngIsoCode CHAR(2)
	,@Search KeyValueVarcharAttribute READONLY
AS
BEGIN
	SET NOCOUNT ON;

	SELECT MTR_CODE AS MtrCode
		,[Value] AS sValue
		,[key] AS sKey
		,Attribute
		,KRL_VALUE AS FoundValue
		,'Krl' AS KwrSource
		,'True' AS AssociatedFlag
	FROM @Search
	INNER JOIN TD_KEYWORD_RELEASE ON [Value] = KRL_VALUE
	INNER JOIN TD_RELEASE ON RLS_ID = KRL_RLS_ID
		AND RLS_DELETE_FLAG = 0
	INNER JOIN TD_MATRIX ON MTR_RLS_ID = RLS_ID
		AND MTR_DELETE_FLAG = 0
	INNER JOIN VW_RELEASE_LIVE_NOW ON RLS_ID = VRN_RLS_ID
		AND MTR_ID = VRN_MTR_ID
	INNER JOIN TM_RELEASE_PRODUCT ON RPR_RLS_ID = RLS_ID
		AND RPR_DELETE_FLAG = 0
	
	UNION
	
	SELECT MTR_CODE AS MtrCode
		,[Value] AS sValue
		,[key] AS sKey
		,Attribute
		,KSB_VALUE AS FoundValue
		,'Ksb' AS KwrSource
		,'True' AS AssociatedFlag
	FROM @Search
	INNER JOIN TD_KEYWORD_SUBJECT ON [Value] = KSB_VALUE
	INNER JOIN TD_SUBJECT ON KSB_SBJ_ID = SBJ_ID
		AND SBJ_DELETE_FLAG = 0
	INNER JOIN TD_PRODUCT ON PRC_SBJ_ID = SBJ_ID
		AND PRC_DELETE_FLAG = 0
	INNER JOIN TM_RELEASE_PRODUCT ON PRC_ID = RPR_PRC_ID
		AND RPR_DELETE_FLAG = 0
	INNER JOIN VW_RELEASE_LIVE_NOW ON RPR_RLS_ID = VRN_RLS_ID
	INNER JOIN TD_MATRIX ON VRN_MTR_ID = MTR_ID
	
	UNION
	
	SELECT MTR_CODE AS MtrCode
		,[Value] AS sValue
		,[key] AS sKey
		,Attribute
		,KPR_VALUE AS FoundValue
		,'Kpr' AS KwrSource
		,'True' AS AssociatedFlag
	FROM @Search
	INNER JOIN TD_KEYWORD_PRODUCT ON [Value] = KPR_VALUE
	INNER JOIN TD_PRODUCT ON KPR_PRC_ID = PRC_ID
		AND PRC_DELETE_FLAG = 0
	INNER JOIN TM_RELEASE_PRODUCT ON RPR_PRC_ID = PRC_ID
		AND RPR_DELETE_FLAG = 0
	INNER JOIN TD_RELEASE ON RLS_ID = RPR_RLS_ID
		AND RLS_DELETE_FLAG = 0
	INNER JOIN TD_MATRIX ON MTR_RLS_ID = RLS_ID
		AND MTR_DELETE_FLAG = 0
	INNER JOIN VW_RELEASE_LIVE_NOW ON VRN_MTR_ID = MTR_ID
		AND VRN_RLS_ID = RLS_ID
END